{% extends 'peliculas/base.html' %}

{% block title %}{{ pelicula.titulo }} - AKA Films{% endblock %}

{% block content %}
<div class="movie-detail">
    <!-- Hero de la pel√≠cula -->
    <div class="movie-hero" style="background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.9)), url('{{ pelicula.poster }}') center/cover;">
        <div class="container">
            <div class="movie-hero-content">
                <div class="movie-poster-large">
                    {% if pelicula.poster %}
                    <img src="{{ pelicula.poster }}" alt="{{ pelicula.titulo }}">
                    {% else %}
                    <div class="poster-placeholder-large">üé¨</div>
                    {% endif %}
                </div>
                <div class="movie-hero-info">
                    <h1 class="movie-title-large">{{ pelicula.titulo }}</h1>
                    {% if pelicula.titulo_original and pelicula.titulo_original != pelicula.titulo %}
                    <p class="movie-original-title">{{ pelicula.titulo_original }}</p>
                    {% endif %}
                    
                    <div class="movie-meta">
                        <span class="meta-item">{{ pelicula.a√±o }}</span>
                        <span class="meta-separator">‚Ä¢</span>
                        <span class="meta-item">{{ pelicula.duracion }} min</span>
                        <span class="meta-separator">‚Ä¢</span>
                        <span class="meta-item">{{ pelicula.clasificacion }}</span>
                    </div>
                    
                    <div class="movie-genres-large">
                        {% for genero in pelicula.generos.all %}
                        <span class="genre-tag-large">{{ genero.nombre }}</span>
                        {% endfor %}
                    </div>
                    
                    <div class="movie-rating-large">
                        <div class="rating-score">
                            <span class="rating-number">{{ pelicula.calificacion_promedio|floatformat:1 }}</span>
                            <span class="rating-max">/10</span>
                        </div>
                        <div class="rating-stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                        <p class="rating-count">{{ pelicula.calificaciones.count }} calificaciones</p>
                    </div>
                    
                    <!-- NUEVA SECCI√ìN: Botones de acci√≥n -->
                    <div class="movie-actions">
                        {% if pelicula.trailer %}
                        <a href="{{ pelicula.trailer }}" target="_blank" class="btn-trailer">
                            ‚ñ∂Ô∏è Ver Trailer
                        </a>
                        {% endif %}
                        
                        {% if user.is_authenticated %}
                        <!-- Bot√≥n de Favoritos -->
                        <form method="post" action="{% url 'peliculas:agregar_favoritos' pelicula.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-action btn-favoritos {% if pelicula in user.peliculas_favoritas.all %}active{% endif %}">
                                {% if pelicula in user.peliculas_favoritas.all %}
                                ‚ù§Ô∏è En Favoritos
                                {% else %}
                                ü§ç Agregar a Favoritos
                                {% endif %}
                            </button>
                        </form>
                        
                        <!-- Bot√≥n de Ver Despu√©s -->
                        <form method="post" action="{% url 'peliculas:agregar_ver_despues' pelicula.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-action btn-ver-despues {% if pelicula in user.peliculas_ver_despues.all %}active{% endif %}">
                                {% if pelicula in user.peliculas_ver_despues.all %}
                                ‚úÖ En tu Lista
                                {% else %}
                                üïí Ver Despu√©s
                                {% endif %}
                            </button>
                        </form>
                        {% else %}
                        <!-- Mensaje para usuarios no autenticados -->
                        <a href="{% url 'login' %}?next={{ request.path }}" class="btn-action btn-login">
                            üîê Inicia sesi√≥n para guardar
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Contenido principal -->
    <div class="container">
        <div class="movie-content">
            <!-- Sinopsis -->
            <section class="content-section">
                <h2 class="content-title">Sinopsis</h2>
                <p class="movie-synopsis">{{ pelicula.sinopsis }}</p>
            </section>
            
            <!-- Informaci√≥n adicional -->
            <section class="content-section">
                <h2 class="content-title">Informaci√≥n</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Director:</span>
                        <span class="info-value">{{ pelicula.director.nombre }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Pa√≠s:</span>
                        <span class="info-value">{{ pelicula.pais }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Idioma:</span>
                        <span class="info-value">{{ pelicula.idioma }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Fecha de Estreno:</span>
                        <span class="info-value">{{ pelicula.fecha_estreno|date:"d/m/Y" }}</span>
                    </div>
                    {% if pelicula.presupuesto %}
                    <div class="info-item">
                        <span class="info-label">Presupuesto:</span>
                        <span class="info-value">${{ pelicula.presupuesto|floatformat:0 }}</span>
                    </div>
                    {% endif %}
                    {% if pelicula.recaudacion %}
                    <div class="info-item">
                        <span class="info-label">Recaudaci√≥n:</span>
                        <span class="info-value">${{ pelicula.recaudacion|floatformat:0 }}</span>
                    </div>
                    {% endif %}
                </div>
            </section>
            
            <!-- Reparto -->
            {% if pelicula.actores.all %}
            <section class="content-section">
                <h2 class="content-title">Reparto</h2>
                <div class="cast-list">
                    {% for actor in pelicula.actores.all|slice:":6" %}
                    <span class="cast-member">{{ actor.nombre }}</span>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
            
            <!-- Calificar pel√≠cula -->
            {% if user.is_authenticated %}
            <section class="content-section">
                <h2 class="content-title">Tu Calificaci√≥n</h2>
                <form method="post" action="{% url 'peliculas:agregar_calificacion' pelicula.id %}" class="rating-form">
                    {% csrf_token %}
                    <div class="rating-input">
                        {% for i in range_10 %}
                        <input type="radio" name="puntuacion" value="{{ i }}" id="rating-{{ i }}"
                               {% if calificacion_usuario and calificacion_usuario.puntuacion == i %}checked{% endif %}>
                        <label for="rating-{{ i }}">{{ i }}</label>
                        {% endfor %}
                    </div>
                    <button type="submit" class="btn-primary">Guardar Calificaci√≥n</button>
                </form>
            </section>
            {% endif %}
            
            <!-- Rese√±as -->
            <section class="content-section">
                <h2 class="content-title">Rese√±as ({{ pelicula.total_resenas }})</h2>
                
                {% if user.is_authenticated %}
                <div class="review-form-container">
                    <h3>Escribe tu rese√±a</h3>
                    <form method="post" action="{% url 'peliculas:agregar_resena' pelicula.id %}" class="review-form">
                        {% csrf_token %}
                        <input type="text" name="titulo" placeholder="T√≠tulo de tu rese√±a" class="form-input" required>
                        <textarea name="contenido" placeholder="Escribe tu opini√≥n sobre la pel√≠cula..." class="form-textarea" rows="5" required></textarea>
                        <button type="submit" class="btn-primary">Publicar Rese√±a</button>
                    </form>
                </div>
                {% endif %}
                
                <div class="reviews-list">
                    {% for resena in resenas %}
                    <div class="review-card">
                        <div class="review-header">
                            <div class="review-author">
                                <span class="author-avatar">üë§</span>
                                <span class="author-name">{{ resena.usuario.username }}</span>
                            </div>
                            <span class="review-date">{{ resena.fecha|date:"d/m/Y" }}</span>
                        </div>
                        <h4 class="review-title">{{ resena.titulo }}</h4>
                        <p class="review-content">{{ resena.contenido }}</p>
                        <div class="review-footer">
                            <span class="review-helpful">üëç {{ resena.util_count }} personas encontraron esto √∫til</span>
                        </div>
                    </div>
                    {% empty %}
                    <p class="no-reviews">A√∫n no hay rese√±as. ¬°S√© el primero en escribir una!</p>
                    {% endfor %}
                </div>
            </section>
        </div>
    </div>
</div>

<style>
/* Estilos para los botones de acci√≥n */
.movie-actions {
    display: flex;
    gap: 15px;
    margin-top: 25px;
    flex-wrap: wrap;
    align-items: center;
}

.btn-action {
    padding: 12px 25px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 16px;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    font-family: 'Poppins', sans-serif;
    white-space: nowrap;
}

.btn-action:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.btn-favoritos.active {
    background: #e50914;
    border-color: #e50914;
}

.btn-favoritos.active:hover {
    background: #c40812;
    border-color: #c40812;
}

.btn-ver-despues.active {
    background: #2ecc71;
    border-color: #2ecc71;
}

.btn-ver-despues.active:hover {
    background: #27ae60;
    border-color: #27ae60;
}

.btn-login {
    background: rgba(229, 9, 20, 0.8);
    border-color: #e50914;
    text-decoration: none;
    display: inline-block;
}

.btn-login:hover {
    background: #e50914;
    border-color: #c40812;
}

.btn-trailer {
    padding: 12px 25px;
    background: #e50914;
    color: white;
    text-decoration: none;
    font-size: 16px;
    font-weight: 600;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: inline-block;
    white-space: nowrap;
}

.btn-trailer:hover {
    background: #c40812;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(229, 9, 20, 0.5);
}

/* Responsive */
@media (max-width: 768px) {
    .movie-actions {
        flex-direction: column;
        width: 100%;
    }
    
    .btn-action,
    .btn-trailer {
        width: 100%;
        text-align: center;
    }
}
</style>
{% endblock %}